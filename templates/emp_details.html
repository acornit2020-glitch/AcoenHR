<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Emplopyee Details</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="../static/img/Acorn.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="../static/css/style.css" rel="stylesheet">
</head>

<body>
<div class="container-fluid position-relative bg-white d-flex p-0">
    
    <!-- Sidebar Start -->
    <div class="sidebar pe-4 pb-3">
        <nav class="navbar bg-light navbar-light">

            <a href="/dashboard" class="navbar-brand mx-4 mb-3">
                <img src="../static/img/Acorn.png" alt="Acorn HR Logo" class="logo" style="height: 60px;">
            </a>

            <div class="d-flex align-items-center ms-4 mb-4">

                <div class="position-relative">
                    <img class="rounded-circle" src="../static/img/user.png" alt="" style="width: 40px; height: 40px;">
                    <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                </div>

                <div class="ms-3">
                    <h6 class="mb-0">Admin</h6>
                    <span>{{ admin_name }} </span>
                </div>

            </div>

            <div class="navbar-nav w-100">
                <a href="/dashboard" class="nav-item nav-link"><i class="fa fa-tachometer-alt me-2"></i>Dashboard</a>
                <a href="/claim_requests" class="nav-item nav-link"><i class="fa fa-eye me-2"></i>Claim Requests</a>
                <a href="/recent_requests" class="nav-item nav-link"><i class="fa fa-history me-2"></i>Recent Requests</a>
                <a href="/admin_form" class="nav-item nav-link"><i class="fa fa-user-plus me-2"></i>Create Employee</a>
                <a href="/emp_details" class="nav-item nav-link active"><i class="fa fa-id-card me-2"></i>Edit Credits</a>
                <a href="/emp_update" class="nav-item nav-link"><i class="fa fa-user-edit me-2"></i>Update Employee</a>
                <a href="/generate_report" class="nav-item nav-link"><i class="fa fa-file-alt me-2"></i>Generate Reports</a>
            </div>

            <!-- Logout Button at the Bottom -->
            <div class="navbar-nav w-100 mt-auto">
                <div style="height: 61px;"></div>
                <hr class="my-2"> <!-- Optional: Add a divider -->
                <a href="/logout" class="nav-item nav-link" style="font-size: 14px;">
                    <i class="fa fa-sign-out-alt text-danger me-2" style="font-size: 12px;"></i> Log Out
                </a>
            </div>

        </nav>

    </div>
    <!-- Sidebar End -->


    <!-- Content Start -->
    <div class="content">

        <!-- Table Start -->
        <div class="container-fluid pt-4 px-4">
            <div class="row g-4">
                <div class="col-12">
                    <input type="text" id="search" class="form-control" placeholder="Search by Employee ID" onkeyup="searchEmployee()">
                </div>

                <div class="table-responsive">
                <div class="bg-light rounded h-100 p-4">
                    <h6 class="mb-4">Employee Claims</h6>
                    <table class="table" id="table">

                        <thead>
                            <tr>
                                <th scope="col">Employee ID</th>
                                <th scope="col">Email</th>
                                <th scope="col">SBU</th>
                                <th scope="col" class="text-danger">Fuel Credit Limit</th>
                                <th scope="col" class="text-primary">Fuel Credit Balance</th>
                                <th scope="col" class="text-danger">OPD Credit Limit</th>
                                <th scope="col" class="text-primary">OPD Credit Balance</th>
                                <th scope="col">Edit</th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for emp in employees %}
                            <tr>
                                <td>{{ emp[0] }}</td>
                                <td>{{ emp[1] }}</td>
                                <td>{{ emp[2] }}</td>
                                <td>{{ emp[3] }}</td>
                                <td>{{ emp[5] }}</td> <!-- opd Credit limit -->
                                <td>{{ emp[4] }}</td>
                                <td>{{ emp[6] }}</td> <!-- OPD Credit Balance -->
                                <td>
                                    <!-- Edit button with data-id to identify the employee -->
                                    <button class="btn btn-primary edit-btn"
                                            data-id="{{ emp[0] }}"
                                            data-fuel="{{ emp[3] }}"
                                            data-fuel-balance="{{ emp[5] }}"
                                            data-opd="{{ emp[4] }}"
                                            data-opd-balance="{{ emp[6] }}">
                                        Edit
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>

                </div>

            </div>

        </div>
        </div>
        <!-- Table End -->

        <!-- Modal for editing credit limits and balances -->
        <div class="modal" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Employee Credits</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="POST" action="{{ url_for('emp_details') }}">
                        <div class="modal-body">
                            <input type="hidden" id="emp_id" name="emp_id" value="">
                            <div class="mb-3">
                                <label for="fuel_limit" class="form-label">Fuel Credit Limit</label>
                                <input type="text" class="form-control" id="fuel_limit" name="fuel_limit" value="">
                            </div>
                            <div class="mb-3">
                                <label for="fuel_balance" class="form-label">Fuel Credit Balance</label>
                                <input type="text" class="form-control" id="fuel_balance" name="fuel_balance" value="">
                            </div>
                            <div class="mb-3">
                                <label for="opd_limit" class="form-label">OPD Credit Limit</label>
                                <input type="text" class="form-control" id="opd_limit" name="opd_limit" value="">
                            </div>
                            <div class="mb-3">
                                <label for="opd_balance" class="form-label">OPD Credit Balance</label>
                                <input type="text" class="form-control" id="opd_balance" name="opd_balance" value="">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    <!-- Content End -->


    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
</div>

<style>
    .table th,
    .table td {
        border-right: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
    }

    .table th:last-child,
    .table td:last-child {
        border-right: none; /* Remove the last column border for clean edges */
    }

    .table thead th {
        border-bottom: 2px solid #ccc; /* Slightly thicker border for the header */
        background-color: #f8f9fa; /* Light background for header */
    }

</style>

<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Template Javascript -->
<script src="../static/js/main.js"></script>
<script>

    function confirmDelete() {
        return confirm("Are you sure you want to delete this employee?");
    }
    
    function searchEmployee() {
        // Get the search input and table
        var input = document.getElementById("search").value.toUpperCase();
        var table = document.getElementById("table");
        var rows = table.getElementsByTagName("tr");

        // Loop through all table rows and hide those who don't match the search
        for (var i = 1; i < rows.length; i++) {
            var firstCell = rows[i].getElementsByTagName("td")[0]; // Employee ID (first column)
            if (firstCell) {
                var id = firstCell.textContent || firstCell.innerText;
                if (id.toUpperCase().indexOf(input) > -1) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }
    }

    // When an Edit button is clicked
    document.querySelectorAll('.edit-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Get employee details from the button data attributes
            const empId = this.getAttribute('data-id');
            const fuelLimit = this.getAttribute('data-fuel');
            const fuelBalance = this.getAttribute('data-fuel-balance');
            const opdLimit = this.getAttribute('data-opd');
            const opdBalance = this.getAttribute('data-opd-balance');

            // Populate the modal fields with the current data
            document.getElementById('emp_id').value = empId;
            document.getElementById('fuel_limit').value = fuelLimit;
            document.getElementById('fuel_balance').value = fuelBalance;
            document.getElementById('opd_limit').value = opdLimit;
            document.getElementById('opd_balance').value = opdBalance;

            // Show the modal
            var myModal = new bootstrap.Modal(document.getElementById('editModal'), {});
            myModal.show();
        });
    });
    
</script>
</body>
</html>
